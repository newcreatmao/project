C51 COMPILER V9.54   ____________                                                          06/05/2024 14:48:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ____________
OBJECT MODULE PLACED IN 模拟电压测量.OBJ
COMPILER INVOKED BY: D:\51project\Keil_v5\keil\C51\BIN\C51.EXE 模拟电压测量.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEN
                    -D TABS(2)

line level    source

   1          /***************************************************************************
   2          实验名称： 模拟电压测量实验（串行）
   3          
   4          实验模块:  51单片机核心板、动态扫描数码管区、串行A/D转换区、可调电压区
   5          
   6          实验接线：  51单片机核心板------串行A/D转换区
   7                    P3.0----------------CLK
   8                    P3.1----------------SDA
   9                    P3.2----------------nCS
  10                    
  11                51单片机核心板------动态扫描数码管区
  12                    P0----------------J6
  13                    P2----------------J5
  14                可调电压区------串行A/D转换区
  15                  TESE-1----------------IN
  16                  
  17          现象描述：  调节可调电压区的旋钮，数码管显示对应的电压值
  18          
  19          更新时间：2017.10.18
  20          ***************************************************************************/
  21          
  22          
  23          #include<reg52.h>
  24          #include <math.h>
  25          #define uchar unsigned char
  26          #define uint  unsigned int 
  27          
  28          sbit CLK = P3^0;  //时钟端口
  29          sbit SDA = P3^1;  //数据端口
  30          sbit CS  = P3^2;  //片选端口
  31          
  32          
  33          #define DIGI P0 //宏定义，将P0口定义为数码管
  34          #define SELECT P2 //宏定义，将P2定义为数码管选择口
  35          
  36          uchar code tab[] = {0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7f,0x6f};
  37          uchar select[]={0x01,0x02,0x04,0x08}; //选择数码管数组，依次选择1，2，..，
  38          
  39          //**********延时n个us函数**********************//
  40          void  delay1(unsigned int delus)//1us
  41          {  
  42   1        while(delus!=0)
  43   1        { 
  44   2         delus--;
  45   2        }
  46   1      }
  47          
  48          void display(float dis2) //函数
  49          {
  50   1      
  51   1          uint dis;
  52   1          dis2*=5000;
  53   1          dis=(uint)dis2;
  54   1          SELECT=select[3]; //选择第i个数码管
C51 COMPILER V9.54   ____________                                                          06/05/2024 14:48:35 PAGE 2   

  55   1          DIGI=tab[dis/1000];
  56   1          delay1(500);
  57   1          SELECT=select[2]; //选择第i个数码管
  58   1          DIGI=tab[dis/100%10];
  59   1          delay1(500);
  60   1          SELECT=select[1]; //选择第i个数码管
  61   1          DIGI=tab[dis/10%10];
  62   1          delay1(500);
  63   1          SELECT=select[0]; //选择第i个数码管
  64   1          DIGI=tab[dis%10];
  65   1      //    delay1(500);
  66   1      
  67   1      }
  68          //******************************************************
  69          //延时子程序
  70          void delay(unsigned int x)
  71          {
  72   1        unsigned int y=x;
  73   1        do{y--;}
  74   1         while(y>1);
  75   1      }
  76          
  77          //******************************************************
  78          //读取转换数值
  79          unsigned int read()
  80          {
  81   1        unsigned int i=0,value=0;
  82   1        delay(2);
  83   1        for(i=0;i<8;i++)
  84   1        {
  85   2          CLK=1;           //产生上升沿
  86   2          value=value<<1;  //数据左移一位
  87   2          if(SDA==1)
  88   2               value=value+1;  //读取数值
  89   2          CLK=0;
  90   2        }
  91   1        return value;        //返回数据
  92   1      }
  93          
  94          //******************************************************
  95          void main()
  96          {
  97   1        uint data2=0;
  98   1        float data1=0;
  99   1        CLK=0;             //初始化时钟端口
 100   1        CS=1;        //片选 
 101   1        while(1)
 102   1        {
 103   2          CS=1;        //片选
 104   2          delay(100);    //等待转换
 105   2          CS=0;
 106   2          data2=read();//读取转换数据 
 107   2          data1=data2/255.0;
 108   2          display(data1);
 109   2        }
 110   1      }
 111          
 112          
 113          
 114          


C51 COMPILER V9.54   ____________                                                          06/05/2024 14:48:35 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    277    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
