/***************************************************************************
实验名称： 并行DA转换实验

实验模块:  51单片机核心板、并行D/A转换区

实验接线：  51单片机核心板------并行D/A转换区
					P0.0--------- CS
					P0.1--------- WR_EN
					P0.2--------- ILE
					P0.3--------- XFRE
					P1	--------- J19
						
现象描述：	使用示波器观察J20口的OUT输出周期性正弦波

更新时间：	2017.10.17
***************************************************************************/
#include"reg52.h"
#define uchar unsigned char 

sbit CS    = P0^0;
sbit WR_EN = P0^1;
sbit ILE   = P0^2;
sbit XFRE  = P0^3;

//******************************************************
//DAC0832初始化子程序，选择直通工作方式
void init( )
{
    CS    = 0;
    WR_EN = 0;
    ILE   = 1;
    XFRE  = 0;
}

//******************************************************
//延时子程序，调节数字i的大小可以改变输出频率的大小
void delay()
{
    unsigned char i;
    for(i=100;i>0;i--);
}

//**********************************************************
//正弦波数据表格
uchar  code tab[128]={128,134,140,146,152,158,165,170,176,
182,188,193,198,203,208,213,218,222,226,230,234,237,240,243,
245,248,250,251,253,254,254,255,255,255,254,254,253,251,250,
248,245,243,240,237,234,230,226,222,218,213,208,203,198,193,
188,182,176,170,165,158,152,146,140,134,127,121,115,109,103,
97,90,85,79,73,67,62,57,52,47,42,37,33,29,25,21,18,15,12,10,
7,5,4,2,1,1,0,0,0,1,1,2,4,5,7,10,12,15,18,21,25,29,33,37,42,
47,52,57,62,67,73,79,85,90,97,103,109,115,121};

//**********************************************************
//正弦波产生函数
void sin( )    //正弦波
{
  unsigned char  i;
  while(1)
  {
   if(++i==128)
      i=0;
   P1=tab[i];
   delay();    //延时，调节输出频率
  }
}


//**********************************************************
//主函数
void main(void)  //主函数
{
    init( );
    P1=0xff;
    while(1)
        {
           sin( );
        }
}