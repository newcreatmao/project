C51 COMPILER V9.54   MAIN                                                                  04/24/2023 22:46:54 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*********************************************************************************
   2          * дʱ䡿 2016129
   3          *     ߡ :03
   4          *      1.0
   5          *     վ http://www.qxmcu.com/ 
   6          * Ա̡ http://qxmcu.taobao.com/ (ֱ)
   7          * ʵƽ̨ QX-MCS51 Ƭ & QX-A51С
   8          * ⲿ񡿣 11.0592mhz 
   9          * оƬ STC89C52
  10          * 뻷 Keil Visio4
  11          * ********************************˵********************************
  12                       "A_"ʾСװ~~~"B_"ʾ     
  13          *幩  A_J5-VCC~~~B_VCC5V0    A_J6-GND~~~B_GND һʹ2Űߣ
  14          *    A_J10-P1.2P1.7 ӦӵB_P1.2P1.7 һʹ6Űߣ
  15          ******************************************************************************
  16          * ܡQX-A51Сң                                  
  17          * ʹ˵Сϵң2ִǰ8ִк
  18                  4ִת6ת5ֹͣ
  19          * עСײϰСӶתСѹܵ6V
  20                  1P32˿ڲܽӶŰߣ޷ңء
  21                  2ңʱң׼Ϻͷ
  22                  3粻ͬѧ뿴Ƶеĺ½ڣһ2Сʱγ̡
  23          **********************************************************************************/
  24          #include <reg52.h> //51ͷļ
  25          #include <HEAD.h>//QX-A51Сļ
  26          
  27          /*====================================
  28           Զ
  29          ====================================*/
  30          typedef unsigned char INT8U;
  31          typedef unsigned char uchar;
  32          
  33          typedef unsigned int INT16U;
  34          typedef unsigned int uint;
  35          
  36          /*====================================
  37           Ӳӿλ
  38          ====================================*/
  39          sbit IR  = P3^2;     //ݽӿ ⲿжO
  40          
  41          uchar IRtime;     //ߵƽʱ䣨
  42          uchar IRcord[4];    //ڴ4ֽڵݣû2ֽ+ֵ2ֽڣ
  43          uchar IRdata[33];   //ڴ33λݣһλΪû16+ֵ16
  44          bit IRpro_ok, IRok;  //һں4ֽϡIRokΪ
  45          
  46          void init()    //ʼʱ0 ⲿж0
  47          {
  48   1        TMOD = 0x02; //ʱ0ʽ28λԶװ
  49   1        TH0 = 0x00;  //8λװ0ôʱһεʱ256
  50   1        TL0 = 0x00;
  51   1        EA = 1;      //ж
  52   1        ET0 = 1;     //ʱ0ж
  53   1        TR0 = 1;     //ʱ0
  54   1      
  55   1        IT0 = 1;     //ⲿж0Ϊشʽһ½شһ
C51 COMPILER V9.54   MAIN                                                                  04/24/2023 22:46:54 PAGE 2   

  56   1        EX0 = 1;     //ⲿж0
  57   1      }
  58          
  59          void time0() interrupt 1   //嶨ʱ0
  60          {
  61   1        IRtime++;          //1Ϊ278us
  62   1      }
  63          
  64          void int0() interrupt 0       //ⲿж0
  65          {
  66   1        static uchar i;       //  ̬ڻִеʱ򲻻ᶪʧֵiڰ33θߵƽĳʱ
             -IRdata
  67   1        static bit startflag;   //ʼ־λ
  68   1        if(startflag)       //ʼ
  69   1        {
  70   2          if( (IRtime < 53) && (IRtime >= 32) ) /*жǷ룬׵ƽ9000us+4500us 
  71   2          Լ11.0592NECЭ8000-10000+4000-5000 
  72   2          Ѿôiᱻ0ͻῪʼδ*/
  73   2            i = 0;         //ôִi=0浽IRdataĵһλ
  74   2          IRdata[i] = IRtime;      //T0ʱ浽浽ж
  75   2          IRtime = 0;        //㣬һ½صʱڴ
  76   2          i++;           //Ĵ
  77   2          if(i == 33)          //34 ±Ǵ0ʼi33ʾִ34
  78   2          {
  79   3            IRok = 1;        //ôʾ
  80   3            i = 0;         //׼´δ
  81   3          }
  82   2        }
  83   1        else      
  84   1        {
  85   2          IRtime = 0;          //뿪ʼ㿪ʼ
  86   2          startflag = 1;       //ʼ־λ1
  87   2        }
  88   1      }
  89          
  90          void IRcordpro()           //ȡ33ݽ
  91          {
  92   1        uchar i, j, k, cord, value; /*iڴ4ֽڣjڴһֽÿһλk33еһλ
  93   1        cordȡʱжǷ1ʱ*/
  94   1        k = 1;            //ӵһλʼȡ
  95   1        for(i = 0; i < 4; i++)
  96   1        {
  97   2          for(j = 0; j < 8; j++)
  98   2          {
  99   3            cord = IRdata[k];     //cord
 100   3            if(cord > 5)      //11.0592t0ΪԼ278us*5=1390ôжΪ1
 101   3            value = value | 0x80; /*յʱȽλ
 102   3            λȷŵvalueλں0x08λһ
 103   3            ıvaluaλֵֻλΪ1*/
 104   3            if(j < 7)
 105   3            {
 106   4              value = value >> 1; //valueλν8λݡ
 107   4            }
 108   3            k++;        //ÿִһλ1
 109   3          }
 110   2          IRcord[i] = value;     //ÿһֽڰIRcordС
 111   2          value = 0;         //value´ڴ
 112   2        }
 113   1        IRpro_ok = 1;          //4ֽںIRpro ok1ʾ 
 114   1      }
 115          /*PWMʹ Сǰ*/
 116          void forward()
C51 COMPILER V9.54   MAIN                                                                  04/24/2023 22:46:54 PAGE 3   

 117          {
 118   1        left_motor_go; //ǰ
 119   1        right_motor_go; //ҵǰ
 120   1      }
 121          
 122            
 123          /*PWMʹ С*/
 124          void backward()
 125          {
 126   1        left_motor_back; //
 127   1        right_motor_back; //ҵ  
 128   1      }
 129          
 130          
 131          /*PWMʹ Сת*/
 132          void left_run()
 133          {
 134   1        left_motor_stops; //ֹͣ
 135   1        right_motor_go; //ҵǰ  
 136   1      }
 137          
 138          
 139          /*PWMʹ Сת*/
 140          void right_run()
 141          {
 142   1        right_motor_stops;//ҵֹͣ
 143   1        left_motor_go;    //ǰ
 144   1      }
 145          
 146          
 147          /*Сֹͣ*/
 148          void stop()
 149          {
 150   1        right_motor_stops;//ҵֹͣ
 151   1        left_motor_stops; //ֹͣ  
 152   1      }
 153          
 154          void main()
 155          {
 156   1        init(); //ִгʼʱ0ⲿж0
 157   1        EN1 = EN2 = 1;//ʹҵ
 158   1        while(1)  //ѭ
 159   1        {
 160   2          if(IRok)    //жǷ                    
 161   2          {   
 162   3            IRcordpro();//4ֽڵ
 163   3            IRok = 0; //µȴ
 164   3            if(IRpro_ok) //жǷ  
 165   3            {
 166   4                  switch(IRcord[2])
 167   4                {
 168   5                   case 0x18:  forward();        //ǰ
 169   5                           break;
 170   5                   case 0x52:  backward();         //  
 171   5                           break;
 172   5                   case 0x08:  left_run();       //ת
 173   5                           break;
 174   5                 case 0x5A:  right_run();        //ת
 175   5                           break;
 176   5                 case 0x1C:  stop();           //ֹͣ
 177   5                           break;
 178   5                 default:break;
C51 COMPILER V9.54   MAIN                                                                  04/24/2023 22:46:54 PAGE 4   

 179   5                }
 180   4              IRpro_ok = 0;
 181   4            }
 182   3          } 
 183   2        }
 184   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    248    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
